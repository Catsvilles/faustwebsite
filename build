#!/bin/sh

#DOMAIN="https://faust.grame.fr/new"
DOMAIN="file:///home/romain/reps/faustwebsite/site"
#DOMAIN="127.0.0.1:8000"

HEADERINCLUDES=$(cat lib/header-includes.html)
HEADER=$(cat lib/std-header.html | awk -v includes="$HEADERINCLUDES" '{gsub(/<!-- INCLUDES -->/,includes)}1')
NAVIGATION=$(cat lib/navigation.html)
HEADER=$HEADER"<body>"$NAVIGATION
HEADER=$(echo "$HEADER" | awk -v domain="$DOMAIN" '{gsub(/__DOMAIN__/,domain)}1')
FOOTERCONTENT=$(cat lib/footer-content.html)
FOOTERINCLUDES=$(cat lib/footer-includes.html)
PAGECLOSING="</body></html>"
FOOTERL=$FOOTERINCLUDES$PAGECLOSING
FOOTERF=$FOOTERCONTENT$FOOTERINCLUDES$PAGECLOSING
MDWPH="<main role=\"main\"><div class=\"container default-container\">"
MDWPF="</div></main>"

rm -rf site
mkdir site

cp -r src/img site
cp -r css site

################################################################################
# Generating main page
################################################################################
echo "$HEADER$(cat src/main.html)$FOOTERF" > site/index.html

################################################################################
# Making doc folder and generating index for it
################################################################################
mkdir site/doc
echo "$HEADER$MDWPH$(pandoc src/doc/doc.md)$MDWPF$FOOTERF" > site/doc/index.html

################################################################################
# Generating Manual
################################################################################
mkdir site/doc/manual
cp -r src/doc/manual/img site/doc/manual/img
cp -r src/doc/manual/misc site/doc/manual/misc 
echo "$HEADER$(cat src/doc/manual/manual.html)$FOOTERL" > site/doc/manual/index.html

################################################################################
# Generating Libraries Doc
################################################################################
mkdir site/doc/libraries
echo "$HEADER$(cat src/doc/libraries/libraries.html)$FOOTERL" > site/doc/libraries/index.html

################################################################################
# Generating Cheat Sheet
################################################################################
mkdir site/doc/cheatsheet
echo "$HEADER$MDWPH$(pandoc src/doc/cheatsheet/cheatsheet.md)$MDWPF$FOOTERF" > site/doc/cheatsheet/index.html

################################################################################
# Generating Tutorials
################################################################################
mkdir site/doc/tutorials
cp -r src/doc/tutorials/img site/doc/tutorials/img
cp -r src/doc/tutorials/misc site/doc/tutorials/misc 
echo "$HEADER$(cat src/doc/tutorials/tutorials.html)$FOOTERL" > site/doc/tutorials/index.html

mkdir site/community
mkdir site/community/news
echo "$HEADER$MDWPH$(pandoc src/community/news/news.md)$MDWPF$FOOTERF" > site/community/news/index.html

mkdir site/tools
echo "$HEADER$MDWPH$(pandoc src/tools/tools.md)$MDWPF$FOOTERF" > site/tools/index.html

cp -r src/tools/editor site/tools
cat src/tools/editor/index.html | awk -v includes="$HEADERINCLUDES" '/<\/head>/{print includes}1' | awk -v nav="$NAVIGATION<main role=\"main\"><div class=\"container-fluid\"><div class=\"navzone\"></div><div class=\"row\">" '/<div class=\"application\">/{print nav}1' | awk '/<script src=\"codemirror\/lib\/codemirror.js\">/{print "</div></main>"}1' | awk '{gsub(/<img src=\"faust-logo.png\" width=58px alt=\"LOGO\">/,"")}1' | awk -v domain="$DOMAIN" '{gsub(/__DOMAIN__/,domain)}1' > site/tools/editor/index.html

# Adding Faust Playground
# TODO: we coul improve the integration of the Faust playground
cp -r src/tools/playground site/tools

# Adding Online Compiler
# TODO: we coul improve the integration of the online compiler
cp -r src/tools/onlinecompiler site/tools

mkdir site/tools/other
echo "$HEADER$MDWPH$(pandoc src/tools/other/other.md)$MDWPF$FOOTERF" > site/tools/other/index.html
